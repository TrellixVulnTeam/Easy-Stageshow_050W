#:kivy 1.10.1
<RV>:
    viewclass: 'SelectableLabel'
    SelectableRecycleBoxLayout:
        default_size: dp(400), None
        default_size_hint: None,0.8
        size_hint_x: None
        width: self.minimum_width
        orientation: 'horizontal'
        multiselect: False
        touch_multiselect: False
<SelectableLabel>:
    # properties
    image:image
    filePath: ''
    enterBGM: ''
    #padding: [20,20]
    width: self.height * 1.3

    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (.0,191/255, 1, .2) if self.selected else (0, 0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:

        pos: root.pos
        size: root.width, root.height
        padding: 20,20
        Image:
            id: image
            source: root.filePath
            allow_stretch: True
            keep_ratio: True
            center: self.parent.center
            size_hint: 1,1

    BoxLayout:
        pos: [root.x, root.y] if root.selected else [root.x, root.y-50]
        size: [250,50]

        Button:
            text: '-'
            on_release: root.parent.parent.delete(root.index)

        Button:
            text: '2'

        Button:
            text: '3'

        Button:
            text: '4'

        Button:
            text: '5'

    Label:
        canvas.before:
            Color:
                rgba: (.0,191/255, 1, .5)
            Line:
                width: 2
                rectangle: self.x, self.y, self.width, self.height

        pos: [root.x, root.height - 50]
        size: [50,50]

        text: root.enterBGM
        text_size: self.width, self.height
        color: (.0,191/255, 1, 1)
        halign: 'center'
        valign: 'center'

<StageSetScreen>:
    rv:rv
    ic:ic
    filechooser: filechooser
    filechooserRoot: './source/img'

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            canvas.before:
                Color:
                    rgba: 0.5, 0.5, 0.5, 1
                Rectangle:
                    size: self.size
                    pos: self.pos

            size_hint_y: None
            height: 30

            Button:
                text: 'Back'
                on_release:
                    root.switchToStageShow()

            Button:
                text: 'load'
                on_release:
                    root.show_load()

            Button:
                text: 'save'
                on_release:
                    root.rv.saveByPath()

            Button:
                text: '4'

            Button:
                text: '5'
        GridLayout:
            rows: 2
            cols: 1
            size_hint_y: 1
            #padding: dp(8)
            #spacing: dp(16)

            RV:
                id:rv
                rootPath: root.filechooserRoot
                viewclass: 'SelectableLabel'
                delegate: root

            CustomFileChooser:

                id: filechooser
                rootpath: root.filechooserRoot
                #filters: ['*.jpg']

                on_selection:
                    root.saveFileToRV(self.selection)
                on_touch_down:
                    root.on_filechoosertouch_down([*args[1].pos])
                on_touch_up:
                    root.on_filechoosertouch_up([*args[1].pos])

    FloatLayout:
        #size: 30, 30
        Label:
            id: ic
            disabled: True
            opacity: 1 if root.fileSelected else 0
            text: '1234567'
            size: 100,100
            size_hint: None, None
            center: 20,20