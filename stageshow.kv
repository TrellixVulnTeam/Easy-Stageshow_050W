#:kivy 1.10.1
#:include KeyboardSetScreen.kv
#:include StageSetScreen.kv
#:include FileChooserDialog.kv
#:include ShowMode.kv

<myLabel>:
    key: '##'
    name: 'my BGM'
    #padding: 4,4 
    #orientation: 'vertical' 
    size: dp(80), dp(80)
    size_hint: None, None
    center: -50,-50



    BoxLayout: 
        padding: 4,4 
        orientation: 'vertical' 
        size: root.width*0.9, root.height*0.9
        #size_hint: 0.9, 0.9 
        center: root.center

        canvas.before: 
            Color: 
                rgba: (.0,191/255, 1, .8) 
            Line: 
                width: 2 
                rectangle: self.x, self.y, self.width, self.height

        Label:
            text: root.key
            halign: 'left'
            color: (.0,191/255, 1, .8)
            #size: root.width, 20
            size_hint: 0.3, 0.3


        Label:
            text: root.name
            text_size: self.width, self.height
            color: (.0,191/255, 1, 1)
            halign: 'center'
            valign: 'center'
            size_hint: 1,0.7

<StageShow>:
    rv:rv
    rvk:rvk
    ic:ic

    BoxLayout:
        orientation: 'vertical'

        on_touch_down:
            root.touchDownEvent([*args[1].pos])

        on_touch_up:
            root.touchUpEvent([*args[1].pos])

        BoxLayout:
            canvas.before:
                Color:
                    rgba: 0.5, 0.5, 0.5, 1
                Rectangle:
                    size: self.size
                    pos: self.pos

            size_hint_y: None
            height: 30

            Button:
                text: 'Show Mode'
                on_press:
                    root.switchToShowMode()

            Button:
                text: 'Stage Settings'
                on_press:
                    root.switchToStageSettings()

            Button:
                text: 'Load'
                on_release:
                    root.show_load()

            Button:
                text: 'Create'
                on_press:
                    root.show_save()

            Button:
                text: 'Keyboard Settings'
                on_press:
                    root.switchToKeyboardSetScreen()

            Button:
                text: '+'
                on_release: print(root.rv.add())
        BoxLayout:
            orientation: 'vertical'
            size_hint: 1,1
            #padding: dp(8)
            #spacing: dp(16)

            RV:
                id:rv
                delegate: root
                size_hint: 1,0.6
                viewclass: 'SelectableLabel'

            RVKeyboard:
                id:rvk
                delegate: root
                size_hint: 1,0.4

    FloatLayout:
        Button:
            opacity: 1
            size: 100,100
            size_hint: None, None
            pos: -100,-100
            on_press:
                print(root.keySelected)

        myLabel:
            id:ic
            opacity: 1 if root.keySelected else 0







<Row@BoxLayout>:
    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.5, 1
        Rectangle:
            size: self.size
            pos: self.pos

    size_hint_y: None
    height: 30

    Button:
        text: 'Add'

    Button:
        text: '2'

    Button:
        text: '3'

    Button:
        text: '4'

    Button:
        text: '+'
        on_release: print(root.parent.rv.add())

<Picture>:
    # Properties

    filePath: ''

    #size: image.size
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (0, 0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        id: image
        source: root.filePath
        padding: [5,5,5,5]
        #pos_hint: 1,1
        center_y: root.center_y
        #center: root.center
        size: root.width*0.9, root.width*0.9 / self.image_ratio

